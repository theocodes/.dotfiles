#!/bin/sh

DOTFILES=$HOME/.dotfiles
CMD=$1

if [[ "$CMD" = "sync" ]]; then
  pushd $DOTFILES
  sudo ln -sf $(pwd)/modules/configuration.nix /etc/nixos/configuration.nix

  # sudo nix-channel --add https://nixos.org/channels/nixos-20.09 nixos
  # sudo nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixpkgs-unstable
  # sudo nix-channel --add https://github.com/nix-community/home-manager/archive/release-20.09.tar.gz home-manager

  sudo nix-channel --add https://nixos.org/channels/nixos-unstable nixos
  sudo nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixpkgs-unstable
  sudo nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager

  sudo nix-channel --update
  pushd
fi

if [[ "$CMD" = "apply" ]]; then
  pushd $DOTFILES
  sudo nixos-rebuild switch --flake .#
  pushd
fi

if [[ "$CMD" = "update" ]]; then
  pushd $DOTFILES
  nix flake update
  pushd
fi
