#!/bin/sh

DOTFILES=$HOME/.dotfiles
CMD=$1

if [[ "$CMD" = "prepare" ]]; then
  pushd $DOTFILES
  sudo ln -sf $(pwd)/configuration.nix /etc/nixos/configuration.nix

  sudo nix-channel --add https://nixos.org/channels/nixos-20.09 nixos
  sudo nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixpkgs-unstable
  #sudo nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
  sudo nix-channel --update

  sudo ln -sf $(pwd)/home.nix ~/.config/nixpkgs/home.nix
  nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
  nix-channel --update
  pushd
fi

if [[ "$CMD" = "sync" ]]; then
  sudo nixos-rebuild switch
fi
